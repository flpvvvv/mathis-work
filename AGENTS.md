# AGENTS.md — Mathis Gallery

## Project

Public gallery webapp for Mathis's artwork at **works.mathis.day**. Neo-brutalism visual style.

- **Stack**: Next.js 15 (App Router), TypeScript, Tailwind CSS 4, shadcn/ui, Supabase (Auth + Postgres + Storage), React Query, Vercel
- **Design spec**: `docs/plans/2026-02-20-mathis-gallery-design.md`
- **Package manager**: pnpm

## Architecture

- Public gallery at `/` with Grid and Timeline views, infinite scroll, full-text search, tag and date filters
- Work detail at `/works/[id]` with image carousel
- Admin CRUD behind `/admin/*` (protected via middleware + Supabase Magic Link auth)
- Client-side perspective correction for uploaded photos (Canvas API + `perspective-transform`)

## Image Pipeline

- All images re-encoded to JPEG 80% on the client before upload
- Stored in Supabase Storage bucket `artworks` at `{work_id}/{image_id}.jpg`
- **No separate thumbnail files exist in Supabase**; thumbnails are generated by Next.js `<Image>` component optimization (responsive `srcset`, WebP/AVIF negotiation)
- `next.config.ts` allows `*.supabase.co` for remote image patterns

## Supabase Setup Requirements

- Storage bucket `artworks` must exist (public read, admin write via RLS)
- RLS policies must allow: public SELECT on `works`, `images`, `tags`, `work_tags`; admin INSERT/UPDATE/DELETE on all four tables
- `profiles` table auto-created via trigger on auth signup; `is_admin` set manually in Supabase Dashboard
- Full-text search index on `works.description` using `tsvector` column `description_tsv`

## Conventions

- Tailwind CSS 4 theme variables in `@theme` block within `globals.css`
- Custom animations must be registered in `@theme` (e.g., `--animate-fade-in-up`) so `motion-safe:` variants work; plain CSS classes are invisible to Tailwind's variant system
- JSX string attributes and JSX text content do NOT process JS unicode escapes (`\u2026`); use the actual character (`…`) instead
- Neo-brutalist styling: `border-2`, `shadow-[var(--shadow-brutal)]`, `rounded-none`, sharp edges
- `motion-safe:` / `motion-reduce:` for all animations (respect `prefers-reduced-motion`)
- `focus-visible:ring-*` on all interactive elements
- Error messages use explicit user-facing copy (see design spec §9)
- Sonner toasts for non-blocking errors; inline confirmation for destructive actions
- Date/number formatting via `Intl.DateTimeFormat` / `Intl.NumberFormat`

## Known Issues / Gotchas

- If gallery shows nothing after upload, check that the `animate-fade-in-up` animation is registered in `@theme` (not just as a standalone CSS class)
- If images don't appear in Supabase Storage after upload, verify: (1) `artworks` bucket exists, (2) bucket RLS allows admin uploads, (3) user is authenticated as admin
- The `getPublicImageUrl` helper constructs URLs as `{SUPABASE_URL}/storage/v1/object/public/artworks/{storage_path}`
